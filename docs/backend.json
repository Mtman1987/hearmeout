{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the HearMeOut application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name, shown in rooms and overlays."
        },
        "profileImageUrl": {
          "type": "string",
          "description": "URL to the user's profile image.",
          "format": "uri"
        },
        "discordId": {
          "type": "string",
          "description": "The user's Discord ID, if linked."
        },
        "twitchId": {
          "type": "string",
          "description": "The user's Twitch ID, if linked."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "displayName"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a voice chat room within the HearMeOut application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Room entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the room."
        },
        "description": {
          "type": "string",
          "description": "A description of the room."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Room). The user ID of the room owner."
        },
        "isPrivate": {
          "type": "boolean",
          "description": "Indicates whether the room is private or public."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the room was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "ownerId",
        "isPrivate",
        "createdAt"
      ]
    },
    "RoomUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RoomUser",
      "type": "object",
      "description": "Represents the many-to-many relationship between users and rooms.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RoomUser entity."
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N RoomUser). The ID of the room."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N RoomUser). The ID of the user."
        },
        "joinedAt": {
          "type": "string",
          "description": "Timestamp of when the user joined the room.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "roomId",
        "userId",
        "joinedAt"
      ]
    },
    "Media": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Media",
      "type": "object",
      "description": "Represents media files (YouTube URLs or uploaded files) that can be played in a room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Media entity."
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Media). The ID of the room where the media is played."
        },
        "type": {
          "type": "string",
          "description": "The type of media (e.g., 'youtube', 'upload')."
        },
        "url": {
          "type": "string",
          "description": "The URL of the media (YouTube URL or storage URL).",
          "format": "uri"
        },
        "uploadedByUserId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Media).  The ID of the user who uploaded the media, if applicable."
        },
        "title": {
          "type": "string",
          "description": "The title of the media."
        },
        "duration": {
          "type": "number",
          "description": "The duration of the media in seconds."
        }
      },
      "required": [
        "id",
        "roomId",
        "type",
        "url",
        "title",
        "duration"
      ]
    },
    "ModerationLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ModerationLog",
      "type": "object",
      "description": "Represents a log entry for moderation events within a room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ModerationLog entity."
        },
        "roomId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N ModerationLog). The ID of the room where the event occurred."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the moderation event occurred.",
          "format": "date-time"
        },
        "sentimentScore": {
          "type": "number",
          "description": "The sentiment score of the conversation at the time of the event."
        },
        "flaggedTerms": {
          "type": "array",
          "description": "A list of terms that triggered the moderation event.",
          "items": {
            "type": "string"
          }
        },
        "description": {
          "type": "string",
          "description": "A description of the moderation event."
        }
      },
      "required": [
        "id",
        "roomId",
        "timestamp",
        "sentimentScore"
      ]
    },
    "ChatMessage": {
      "title": "Chat Message",
      "description": "Represents a single chat message sent in a room.",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user at the time of sending."
        },
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "createdAt": {
          "type": "string",
          "description": "The server timestamp when the message was created.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "displayName",
        "text",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "discord"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for user data. The userId path parameter matches the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room information. Includes denormalized 'ownerId' for authorization independence.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique ID of the room."
            }
          ]
        }
      },
      {
        "path": "/room_users/{roomUserId}",
        "definition": {
          "entityName": "RoomUser",
          "schema": {
            "$ref": "#/backend/entities/RoomUser"
          },
          "description": "Stores the relationships between users and rooms.",
          "params": [
            {
              "name": "roomUserId",
              "description": "The unique ID of the RoomUser entry."
            }
          ]
        }
      },
      {
        "path": "/rooms/{roomId}/media/{mediaId}",
        "definition": {
          "entityName": "Media",
          "schema": {
            "$ref": "#/backend/entities/Media"
          },
          "description": "Stores media files associated with a room.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique ID of the room."
            },
            {
              "name": "mediaId",
              "description": "The unique ID of the media."
            }
          ]
        }
      },
      {
        "path": "/rooms/{roomId}/moderation_logs/{moderationLogId}",
        "definition": {
          "entityName": "ModerationLog",
          "schema": {
            "$ref": "#/backend/entities/ModerationLog"
          },
          "description": "Stores moderation logs for each room.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique ID of the room."
            },
            {
              "name": "moderationLogId",
              "description": "The unique ID of the moderation log."
            }
          ]
        }
      },
      {
        "path": "/rooms/{roomId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for a room.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique ID of the room."
            },
            {
              "name": "messageId",
              "description": "The unique ID of the chat message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. Authorization Independence is achieved through denormalization. For example, the `rooms` collection denormalizes the `ownerId` property within each room document, allowing security rules to validate ownership without requiring expensive `get()` operations. Similar denormalization occurs with the membership model for collaborative access. Structural Segregation is applied by using separate collections for different data types (users, rooms, media, moderation logs). Access Modeling is standardized using path-based ownership for user-related data (`/users/{userId}/rooms/{roomId}`) and a membership map (`members`) for collaborative access, although in this design, the path-based ownership pattern is preferred where possible. The structure supports QAPs by ensuring that list operations can be secured without complex filtering within rules, due to the segregation of data based on access needs.\n\nSpecifically:\n\n*   **Users:** User profiles are stored in `/users/{userId}` using path-based ownership, granting each user full control over their profile data.\n*   **Rooms:** Rooms are stored in `/rooms/{roomId}`, with the `ownerId` field denormalized in each document, ensuring that rules can enforce ownership without additional reads.\n*   **RoomUser:** This relationship is managed through `/room_users/{roomUserId}`, simplifying queries to find users in a room or rooms a user has joined.\n*   **Media:** Media files are stored in `/rooms/{roomId}/media/{mediaId}`, linking them directly to rooms and allowing for easy retrieval of media associated with a room.\n*   **Moderation Logs:** Moderation logs are stored in `/rooms/{roomId}/moderation_logs/{moderationLogId}`, associating them directly with rooms for auditing and analysis."
  }
}
    